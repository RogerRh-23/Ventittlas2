<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inicio de Sesión</title>
    <link rel="icon" type="image/x-icon" href="../assets/img/logo.png">
    <link rel="stylesheet" href="../styles/main.css">
</head>

<body>
    <a class="back-btn" href="../index.html" aria-label="Volver al inicio">
        <img src="../assets/icons/arrow.svg" alt="Volver" />
    </a>

    <main class="login-main">
        <section class="login-section">
            <div class="login-card">
                <h2>Iniciar Sesión</h2>
                <form class="login-form" id="loginForm">
                    <label for="email">Correo electrónico:</label>
                    <input type="email" id="email" name="email" placeholder="tu@correo.com" required>

                    <label for="password">Contraseña:</label>
                    <input type="password" id="password" name="password" required>

                    <button type="submit">Iniciar Sesión</button>
                </form>
                <div id="login_msg" class="msg"></div>
                <script>
                document.getElementById('loginForm').addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const email = document.getElementById('email').value.trim();
                    const password = document.getElementById('password').value;
                    const msg = document.getElementById('login_msg');
                    msg.textContent = 'Verificando...';
                    try {
                        const res = await fetch('/php/api/login.php', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ correo_electronico: email, contrasena: password })
                        });
                        const body = await res.json().catch(() => null);
                        if (res.ok && body && body.ok) {
                            msg.textContent = 'Inicio de sesión correcto, redirigiendo...';
                            // redirect según rol si el backend lo indica
                            const redirect = (body.redirect || '/index.html');
                            setTimeout(() => window.location.href = redirect, 700);
                        } else {
                            msg.textContent = (body && body.message) ? body.message : ('Error HTTP ' + res.status);
                        }
                    } catch (err) {
                        msg.textContent = 'Error de red: ' + err.message;
                    }
                });
                </script>
            </div>
        </section>
    </main>
</body>

</html>