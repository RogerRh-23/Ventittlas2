<!doctype html>
<html lang="es">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>Admin - Registro de Usuarios</title>
	<link rel="stylesheet" href="/styles/main.css">
</head>
<body>
	<main class="container">
		<h1>Panel de administración — Registro de usuarios</h1>

		<section id="cliente">
			<h2>Registrar Cliente</h2>
			<form id="form-cliente">
				<label>Nombre completo<br>
					<input type="text" name="full_name" id="cliente_full_name" required>
				</label>

				<label>Teléfono<br>
					<input type="tel" name="phone" id="cliente_phone" pattern="[0-9()+\-\s]{6,20}" required>
				</label>

				<label>Correo<br>
					<input type="email" name="email" id="cliente_email" required>
				</label>

				<label>Contraseña<br>
					<input type="password" name="password" id="cliente_password" minlength="6" required>
				</label>

				<label>Dirección / Ubicación<br>
					<input type="text" name="address" id="cliente_address" required>
				</label>

				<p><button type="submit">Registrar Cliente</button></p>
				<div id="cliente_msg" class="msg"></div>
			</form>
		</section>

		<hr>

		<section id="trabajador">
			<h2>Registrar Trabajador</h2>
			<form id="form-trabajador">
				<label>Nombre completo<br>
					<input type="text" name="full_name" id="trab_full_name" required>
				</label>

				<label>Teléfono<br>
					<input type="tel" name="phone" id="trab_phone" pattern="[0-9()+\-\s]{6,20}" required>
				</label>

				<label>Correo<br>
					<input type="email" name="email" id="trab_email" required>
				</label>

				<label>Contraseña<br>
					<input type="password" name="password" id="trab_password" minlength="6" required>
				</label>

				<label>RFC<br>
					<input type="text" name="rfc" id="trab_rfc" pattern="[A-Za-z0-9]{10,13}" required>
				</label>

				<p><button type="submit">Registrar Trabajador</button></p>
				<div id="trab_msg" class="msg"></div>
			</form>
		</section>

	</main>

	<script>
	// postJSON: envía JSON y devuelve { status, ok, body }
	async function postJSON(url, data) {
		const res = await fetch(url, {
			method: 'POST',
			headers: { 'Content-Type': 'application/json' },
			body: JSON.stringify(data)
		});
		let body = null;
		try { body = await res.json(); } catch (e) { body = null; }
		return { status: res.status, ok: res.ok, body };
	}

	document.getElementById('form-cliente').addEventListener('submit', async (e) => {
		e.preventDefault();
		// mapear a los nombres que esperan los endpoints PHP
		const data = {
			nombre: e.target.full_name.value.trim(),
			telefono: e.target.phone.value.trim(),
			correo_electronico: e.target.email.value.trim(),
			contrasena: e.target.password.value,
			direccion: e.target.address.value.trim()
		};
		const msg = document.getElementById('cliente_msg');
		msg.textContent = 'Enviando...';
		const r = await postJSON('/php/api/register_client.php', data);
		if (r.ok) {
			// preferir body.message/ message, success/ok flags if existen
			if (r.body && (r.body.success === true || r.body.ok === true)) {
				msg.textContent = 'Cliente registrado correctamente';
			} else if (r.body && (r.body.message || r.body.error)) {
				msg.textContent = r.body.message || r.body.error;
			} else if (r.body) {
				msg.textContent = 'Registro completado (respuesta inesperada): ' + JSON.stringify(r.body);
			} else {
				msg.textContent = 'Registro completado (sin JSON devuelto).';
			}
		} else {
			msg.textContent = 'Error HTTP ' + r.status + (r.body && (r.body.message || r.body.error) ? (': ' + (r.body.message || r.body.error)) : '');
		}
	});

	document.getElementById('form-trabajador').addEventListener('submit', async (e) => {
		e.preventDefault();
		const data = {
			nombre: e.target.full_name.value.trim(),
			telefono: e.target.phone.value.trim(),
			correo_electronico: e.target.email.value.trim(),
			contrasena: e.target.password.value,
			rfc: e.target.rfc.value.trim()
		};
		const msg = document.getElementById('trab_msg');
		msg.textContent = 'Enviando...';
		const r = await postJSON('/php/api/register_worker.php', data);
		if (r.ok) {
			if (r.body && (r.body.success === true || r.body.ok === true)) {
				msg.textContent = 'Trabajador registrado correctamente';
			} else if (r.body && (r.body.message || r.body.error)) {
				msg.textContent = r.body.message || r.body.error;
			} else if (r.body) {
				msg.textContent = 'Registro completado (respuesta inesperada): ' + JSON.stringify(r.body);
			} else {
				msg.textContent = 'Registro completado (sin JSON devuelto).';
			}
		} else {
			msg.textContent = 'Error HTTP ' + r.status + (r.body && (r.body.message || r.body.error) ? (': ' + (r.body.message || r.body.error)) : '');
		}
	});
	</script>
</body>
</html>